const input = `*.........../..*..../.../......./.....*.................-..............-......./..-................./.*|......
../..|..*..*...........*..........-..|.|...........................|...../..............-.................-../
.|..*................../...........................|..............|...-.................././........./........
......./....*.|................**....|...*......................../*......|......../..........-........./.....
........................-......................|...*.............-..|..|..........|...........................
.............../-............*....*...............-......*..-.............*./...........|.....................
........./|.|...........................-.........................-.-.......*.........-.......*/....|.........
............-.-.........*........../........|..........||............./.-.....................................
................||.....|................-........*............./.................-....../......|..........*...
........................../*..|.......|........|.|..../../.../.....-.-..-..-..........................*.......
..-.......*..............|.|...........|............./....-...........|......-.......|...........|.|....*.....
.*./.*.....-.................................|.......-|...*..........*.........-./......./...................*
....|.................|..............|..|.*............**...*......*..................-..................*../|
..........|.....*..............................|.-.*................-................./|............../.......
..*|......./............-...............|...|...-..|................../..../.|.........*..........-.........*.
.|*............../............-/.........*.......*.........../........................./......................
...*..................................................*...|...............*..............*....................
..|........./..........|..........................././..............................................**.|......
...........-.-..............*..-............-..................|/|..............|..-...../.|................*.
..........|..|.../...........................|....-....../........................-.........|.................
*.....................*............/...........-....................../.*...........-..../..........*.........
........-................***.........|/....../*..|..|.-...-..............*.....|..............-.........-.....
..........-........-....|.................-.........................**...-...*|..|.............../.....*.|....
.............................................................|........*-................-....................*
/......*....|-............./...........|................/...*.........|.....-.............|/...|..|...../.....
|...-.........-....................................././|..*...*..../.......|.......*................../.......
...........-..-........../........................**...................................*......................
............*.......**|.|.......-.............|..../........-.....|....|.../.-............./.-........../...|.
...................................-..............*...*....*...|..........|.................../..../.......|..
...-...............|......*|/...............-./..../........................*......../.....................|..
.........................................|....*.*..............*-...**........*.../...........././............
......|........./.|./.................-...../..--.......|...............-.*......|...................|........
.....-.-..............|............../...................*/......./.....|............|....-...................
...-./..........-..........*...../.......-................./........-............................*....*.......
*.../.....|....................*|...........................*.......*.../../............/.....................
.................-.............-.|/..............-.......*...-..|..|........*..../....../...|.................
.........-.................-..........|..........*...................*............./.................-.....*..
....................|........./......|................/.............|................/.*....|............*..|.
..........................**..../................./.........../-..||......./.............|--....|........*-.-.
.......-.........|..-......-.....*.......................................*-......./.....*.......*/......*.....
............-.......*.............-....||.-.....................*........../..................................
...|........-......*....|.......-.....|.-......*........./.-....-..................../..|..................*..
....*..-.....*.......*.....................-.........*............/.....-.../......-..................*.......
.......-...........*.../..............*..........*..........-................../....-..|....-.......-.........
..../......|...................../*|......-.......-|.........*......|..../||............*........|............
......*.............|...-..................*...|.............-|..-........|................*..................
|./../.............................-..............|.../.....-......|.....*......./........-.......*...........
.............................|...../......*.................*......-.....|..../................./......./.....
..../................-.-..........*....*...........*......*....|*..................|...../|.......-.........*.
.........../.-.....././..|..................................-..........*................/........../|....|....
.||........*.....*.-....*-........................../............................................-..../.......
.../...*.....-*...........*..........|.*...|*..............|........|........|..**.../.|............|.........
.......*..-....../......./..................*...../*.-....................|.......*.......-...................
...-..........*/..........-...|..................|..................-.../.............-..............**..-./..
....*...|..|...........-.........|.............................*....-....../..*......................../...../
.-../..*..........|....|........../.......-......................*..............-.....................-.......
|................/..-...........-.*...-|......./.......*..-.....|....*......../............*..................
../../-*-....................|...........|...|..................-...|...........*.......*.....*.........-/....
......................................-...-................/.....|..-../..*................|./...../.../......
....................../.........*......|.*.../......................*...*.....-....................|..........
.........|.-.......*/...../-......|....-.....-.-...........|..........................|....--.........|.......
........................................-............./....-........|........|||-.....*....................*..
...............|*.............**..-.....|....................*.....-........................*.....|.......|...
.......|..............................................................................................*.*/*...
.................|..../..................../.......*............|....................|.-........|....*.|......
|...............-.................................*........*...........-...................-................|.
.*.........../....||..............................................|......-.....|......................-.|.....
......././.........../...........*.......-...--./|..-......................*............./.....|...|..........
..*...|............|..|.*..........|../.............-...*............|...................................../..
...................|.-..........-..........|..*...../..../....*.//..........|./...............................
./|...../....../..................-*......|.......|.......*.............|....*............./.|..-...-......../
.|....*........*........-....|........../........-.........*..............................................*...
.....-|..........|....-..................-............................/.|..........*.............../......../.
.........................*.........|.......|./.../.......*........-........................*..-*.../..........
.....*....-*..............-......................-....*..................-............................/.......
.............|...|.............-...*.....|..*................*-..............|.......*........................
.....|............|./..*......................./..../............../......../.......................|-....-...
....|....|.......*..|...../......................................*......................-....|..............|.
.*..../.....-.../.........../................/..*....*............./......*....*............../...............
/|../...................--.......*....../..-./....-.......................*..../|.............*...|..../......
.....-.........-...........-.........|.........................../.............|...-.....-......|.............
............./.......-..../.....|....|............*./....*/.................................../...............
....*.........*................|...-.....-.......................................*........|........../........
............................-...........|...|......../..-......**...../....................|.....|.........-..
..*./.....-...|-...........*....-....................................*.............-..........*...............
.................|.*/.-....../............-...*.............*..../.*...*........|............-./............./
..*..............|..-*.|.............../...............-*..|../.........................*.....................
....-..........././............/......-........-..........-.....-*................../.........................
....-......*...|......./.................-.........................../.../..../*.......|............./........
...|...*........*............................*..........*|..*.-..................../...........|..-*...|.../..
./.............|.................../..|..|..............|............|.............-...../.|..................
................/....*.........|...................|.....-/..../..**........*........./....|....-..../.....*..
|..............*......*............................................/......||............|/....*..........|.-..
.............|...........|..........|..............*............*...*.........|...............................
...../....../*....................../............./.................*.-.......|../-...........................
*....................|....|...|.*/............-|...|.........................|.................../../.........
...........*|..|..-...........-...............................-*|............./..................*..........|.
.........-./....*........*.............-........-.|....................|......................../*............
..|...............*......-.........................................................*...././...................
/...|...........-....*.................................*./.......|...../...../.|........-.-.................|.
/..........*......../......|........|......................................../................*....|.......*.*
*..*....-..........//.........................*.....*....................................................*....
......../.............-........................|........................../*.................|................
.........................................|................./.....-.........-......|//.-........//........-..|.
......../.*.../............./........|*.....-..*./...........................-....-........|.*|/............*.
.*.../.....|...../.|.....................-................|..................../..-...*....*..............|...
/.............|./...../..-.........*.|..............|.......|.....|..../...|...*..................-./.........
..........|..............*................*....../.-../..-....|.....|.........-...............................
.............../............|........................../......./.*.....................-...|./.......-.....*..
.................../.......|.|...........*./-./*||.|....|........-...........*......-....-..........-.........`

const test = `.|...*....
|.-.*.....
.....|-...
........|.
..........
.........*
..../.**..
.-.-/..|..
.|....-|.*
..//.|....` 

let map = input.split("\n")

let h = map.length;
let w = map[0].length

// console.log(beamTiles)

let DIR_ENUM = {
    UP: 1,
    DOWN: 2,
    RIGHT: 3,
    LEFT: 4,
}


function beamPassed(beam, tiles){
    let passes = tiles[beam.r][beam.c];
    let passed = passes.find((p) => p === beam.dir);
    return passed;
}

function isHorizontalDir(dir){
    return dir === DIR_ENUM.LEFT || dir === DIR_ENUM.RIGHT;
}
function isVerticalDir(dir){
    return dir === DIR_ENUM.UP || dir === DIR_ENUM.DOWN;
}

let beam = { dir: DIR_ENUM.RIGHT, r: 0, c: 0 }

function calculateEnergy(beam){
    let beams = [];
    let beamTiles = map.map((l) => l.split("").map((t) => []))
    let energized = map.map((l) => l.split("").map((t) => false))
    
    while (beam){
        let beamFinished = false;
        while (!beamFinished){
            // check beam out of bands
            if (beam.r < 0 || beam.c < 0 || beam.r >= h || beam.c >= w){
                beamFinished = true;
            }else if (beamPassed(beam, beamTiles)){
                beamFinished = true;
            }else {
                beamTiles[beam.r][beam.c].push(beam.dir);
                energized[beam.r][beam.c] = true;
    
                let tile = map[beam.r][beam.c];
                if (tile === "." || (tile === "-" && isHorizontalDir(beam.dir)) ||
                    (tile === "|" && isVerticalDir(beam.dir))){
                    switch (beam.dir){
                        case DIR_ENUM.UP:
                            beam.r--;
                            break;
                        case DIR_ENUM.DOWN:
                            beam.r++;
                            break;
                        case DIR_ENUM.LEFT:
                            beam.c--;
                            break;
                        case DIR_ENUM.RIGHT:
                            beam.c++;
                            break;
                        default:
                            console.log(" UNEXPECTED DIRECTION ");
                    }
                }else if (tile === "-"){
                    // reached from up or down
                    beams.push({ dir: DIR_ENUM.RIGHT, r: beam.r, c: beam.c++ })
                    beam.dir = DIR_ENUM.LEFT;
                    beam.c--;
                }else if (tile === "|"){
                    // reached from left or right
                    beams.push({ dir: DIR_ENUM.UP, r: beam.r--, c: beam.c })
                    beam.dir = DIR_ENUM.DOWN;
                    beam.r++;
                }else if (tile === "*"){
                    // equals \ tile
                    switch (beam.dir){
                        case DIR_ENUM.UP:
                            beam.dir = DIR_ENUM.LEFT;
                            beam.c--;
                            break;
                        case DIR_ENUM.DOWN:
                            beam.dir = DIR_ENUM.RIGHT;
                            beam.c++;
                            break;
                        case DIR_ENUM.LEFT:
                            beam.dir = DIR_ENUM.UP;
                            beam.r--;
                            break;
                        case DIR_ENUM.RIGHT:
                            beam.dir = DIR_ENUM.DOWN;
                            beam.r++;
                            break;
                        default:
                            console.log(" UNEXPECTED DIRECTION ");
                    }
                }else if (tile === "/"){
                    switch (beam.dir){
                        case DIR_ENUM.UP:
                            beam.dir = DIR_ENUM.RIGHT;
                            beam.c++;
                            break;
                        case DIR_ENUM.DOWN:
                            beam.dir = DIR_ENUM.LEFT;
                            beam.c--;
                            break;
                        case DIR_ENUM.LEFT:
                            beam.dir = DIR_ENUM.DOWN;
                            beam.r++;
                            break;
                        case DIR_ENUM.RIGHT:
                            beam.dir = DIR_ENUM.UP;
                            beam.r--;
                            break;
                        default:
                            console.log(" UNEXPECTED DIRECTION ");
                    }
                }
                
            }
        }
    
        beam = beams.shift();
    }
    let count = 0;
    for (let i = 0; i < energized.length; i++){
        for (let j = 0; j < energized[i].length; j++){
            if (energized[i][j]){
                count++;
            }
        }
    }
    return count;
}

let max = 0;
for (let i = 0; i < w; i++){
    let beam = { dir: DIR_ENUM.DOWN, r: 0, c: i }
    let energy = calculateEnergy(beam);
    max = Math.max(energy, max);
    beam = { dir: DIR_ENUM.UP, r: h - 1, c: i }
    energy = calculateEnergy(beam);
    max = Math.max(energy, max);
}
for (let i = 0; i < h; i++){
    let beam = { dir: DIR_ENUM.RIGHT, r: i, c: 0 }
    let energy = calculateEnergy(beam);
    max = Math.max(energy, max);
    beam = { dir: DIR_ENUM.LEFT, r: i, c: w - 1 }
    energy = calculateEnergy(beam);
    max = Math.max(energy, max);
}


console.log(max);
